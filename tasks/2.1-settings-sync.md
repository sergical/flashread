# Task 2.1: Cross-Device Settings Sync

**Status:** pending  
**Phase:** 2 - Sync & Analytics  
**Depends on:** Task 1.7  
**Estimated Time:** 30 minutes

## Goal

Sync user settings across all devices for Pro users.

## Steps

### 1. Database Table
```sql
CREATE TABLE user_settings (
  user_id UUID REFERENCES profiles(id) PRIMARY KEY,
  settings JSONB NOT NULL DEFAULT '{}',
  updated_at TIMESTAMP DEFAULT NOW()
);

ALTER TABLE user_settings ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own settings" ON user_settings
  FOR ALL USING (auth.uid() = user_id);
```

### 2. API Endpoints
- [ ] `GET /api/sync/settings` - Fetch user settings
- [ ] `PUT /api/sync/settings` - Update user settings

### 3. Extension Sync Logic
- [ ] Modify `storage.ts` to check `isPro`
- [ ] If Pro: sync settings with server
- [ ] If Free: use local storage only
- [ ] On settings change: push to server
- [ ] On extension startup: pull from server

### 4. Conflict Resolution
- [ ] Server timestamp wins (last write wins)
- [ ] Merge settings objects, don't replace entirely

## Acceptance Criteria

- [ ] Pro user's settings sync across devices
- [ ] Settings changes reflect within seconds
- [ ] Works offline (queues changes)
- [ ] Free users unaffected (local only)
