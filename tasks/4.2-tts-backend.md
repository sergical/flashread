# Task 4.2: ElevenLabs TTS - Backend

**Status:** pending  
**Phase:** 4 - Audio Features  
**Depends on:** Task 1.7  
**Estimated Time:** 45 minutes

## Goal

Create API for generating synchronized TTS audio.

## Steps

### 1. ElevenLabs Setup
- [ ] Create ElevenLabs account
- [ ] Get API key
- [ ] Add to `.env`:
  ```
  ELEVENLABS_API_KEY=...
  ```

### 2. Voice Selection
Choose 5-10 voices:
- [ ] 2-3 male voices (different accents)
- [ ] 2-3 female voices (different accents)
- [ ] 1-2 neutral/professional voices

Store voice IDs:
```typescript
const VOICES = {
  'rachel': 'voice_id_1',    // Female, American
  'adam': 'voice_id_2',      // Male, American
  'bella': 'voice_id_3',     // Female, British
  'james': 'voice_id_4',     // Male, British
  // ...
};
```

### 3. API Endpoint
- [ ] Create `POST /api/tts/generate`

```typescript
// Request
{
  text: string,
  voiceId: string,
  speed?: number,  // 0.5 - 2.0
}

// Response
{
  audioUrl: string,  // URL to audio file
  wordTimestamps: Array<{
    word: string,
    start: number,  // ms
    end: number,    // ms
  }>,
  duration: number,  // total ms
}
```

### 4. ElevenLabs API Call
```typescript
const response = await fetch(
  `https://api.elevenlabs.io/v1/text-to-speech/${voiceId}/with-timestamps`,
  {
    method: 'POST',
    headers: {
      'xi-api-key': process.env.ELEVENLABS_API_KEY,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      text,
      model_id: 'eleven_turbo_v2',
      voice_settings: {
        stability: 0.5,
        similarity_boost: 0.75,
        speed: speed || 1.0,
      },
    }),
  }
);
```

### 5. Audio Storage
- [ ] Save generated audio to storage (S3/R2)
- [ ] Return public URL
- [ ] Cache by text hash + voice

### 6. Rate Limiting
- [ ] Track character usage per user
- [ ] Soft limit: 100,000 chars/month
- [ ] Return usage in response

## Acceptance Criteria

- [ ] API generates audio with word timestamps
- [ ] Multiple voice options work
- [ ] Audio files accessible via URL
- [ ] Caching prevents duplicate generation
- [ ] Usage tracking functional

## Cost Estimate

- ElevenLabs Starter: ~$0.30/1000 chars
- Average article: ~5000 chars = ~$1.50/article
- With 100k char limit: ~20 articles/month
