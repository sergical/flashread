# Task 4.3: ElevenLabs TTS - Extension UI

**Status:** pending  
**Phase:** 4 - Audio Features  
**Depends on:** Task 4.2  
**Estimated Time:** 45 minutes

## Goal

Integrate TTS playback synced with RSVP display.

## Steps

### 1. TTS Generation Flow
When reading starts with TTS enabled:
1. Show "Generating voice..." loading state
2. Call `/api/tts/generate` with article text
3. Receive audio URL + word timestamps
4. Load audio
5. Begin synchronized playback

### 2. Sync Logic
```typescript
class TTSSync {
  private audio: HTMLAudioElement;
  private timestamps: WordTimestamp[];
  private engine: RSVPEngine;
  
  sync() {
    // Find current word based on audio time
    const currentTime = this.audio.currentTime * 1000;
    const wordIndex = this.timestamps.findIndex(
      t => currentTime >= t.start && currentTime < t.end
    );
    
    // Sync RSVP engine to match
    if (wordIndex !== this.engine.currentIndex) {
      this.engine.seek(wordIndex);
    }
  }
}
```

### 3. Playback Controls
- [ ] TTS toggle in overlay (separate from music)
- [ ] Voice selector dropdown
- [ ] Volume control
- [ ] Visual indicator when TTS active

### 4. Settings
```typescript
interface TTSSettings {
  enabled: boolean;
  voiceId: string;
  volume: number;
  autoGenerate: boolean;  // Generate on read start
}
```

### 5. Overlay UI Addition
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Voice: [Rachel â–¼]  [ğŸ”Š 75%]  [TTS: ON] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Play/Pause Sync
- [ ] TTS pauses when RSVP pauses
- [ ] TTS resumes when RSVP resumes
- [ ] Seeking RSVP seeks TTS audio
- [ ] Speed changes regenerate audio (or adjust playback rate)

### 7. Error Handling
- [ ] Graceful fallback if generation fails
- [ ] "TTS unavailable" message
- [ ] Continue reading without audio

### 8. Free User Handling
- [ ] Show locked TTS controls
- [ ] "Upgrade to Pro for AI Voice"
- [ ] Teaser: play 10 seconds of sample voice?

## Acceptance Criteria

- [ ] TTS audio plays in sync with word display
- [ ] Voice selection works
- [ ] Play/pause syncs between RSVP and TTS
- [ ] Seeking works in both directions
- [ ] Loading state during generation
- [ ] Graceful error handling
